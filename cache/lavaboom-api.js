(function(){var t,e,n;t=function(){var t,e,n;if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;for(e=["MSXML2.XmlHttp.5.0","MSXML2.XmlHttp.4.0","MSXML2.XmlHttp.3.0","MSXML2.XmlHttp.2.0","Microsoft.XmlHttp"],n=void 0,t=0;t<e.length;){try{n=new ActiveXObject(e[t]);break}catch(s){}t++}return n},n=function(t){var e,n,s,r,o,i,a;if(s={},!t)return s;for(n=t.split("\r\n"),r=0;r<n.length;)e=n[r],o=e.indexOf(": "),o>0&&(i=e.substring(0,o),a=e.substring(o+2),s[i]=a),r++;return s},e=function(t){var e,n,s,r;for(n=[],s=0,r=t.length;r>s;s++)e=t[s],n.push(encodeURIComponent(e)+"="+encodeURIComponent(t[e]));return n.join("&")},this.Lavaboom=function(){function s(t,e){var n;t||(t="https://api.lavaboom.com"),this.url=t,this.token=e,"undefined"!=typeof SockJS&&(this.sockjs=new SockJS(t+"/ws"),this.counter=0,this.handlers={},this.queuedMessages=[],this.connected=!1,n=this,this.sockjs.onopen=function(){return n.connected=!0,n.queuedMessages.length>0?_.forEach(n.queuedMessages,function(t){return n.sockjs.send(t)}):void 0},this.sockjs.onmessage=function(t){var e;return e=JSON.parse(t.data),n.handlers[e.id]?n.handlers[e.id](e):void 0}),this.accounts.that=this,this.accounts.create.that=this,this.contacts.that=this,this.emails.that=this,this.keys.that=this,this.labels.that=this,this.tokens.that=this}return s.prototype._sockReq=function(t,e,n,s){var r,o;return this.counter++,o={onSuccess:[],onFailure:[],then:function(t){return this.onSuccess.push(t),this},"catch":function(t){return this.onFailure.push(t),this}},this.handlers[this.counter.toString()]=function(t){return t.status>=200&&t.status<300?_.forEach(o.onSuccess,function(e){return e(JSON.parse(t.body))}):_.forEach(o.onFailure,function(e){return e(JSON.parse(t.body))})},s||(s={}),s.headers||(s.headers={}),("POST"===t||"PUT"===t)&&(s.headers["Content-Type"]="application/json;charset=utf-8"),r=JSON.stringify({id:this.counter.toString(),type:"request",method:t,path:e,body:JSON.stringify(n),headers:s.headers}),this.connected?this.sockjs.send(r):this.queuedMessages.push(r),o},s.prototype.ajax=function(e,s,r,o){var i,a,u;a={onSuccess:[],onFailure:[],then:function(t){return this.onSuccess.push(t),this},"catch":function(t){return this.onFailure.push(t),this}},u=t(),u.open(e,s,!0),u.onreadystatechange=function(){return 4===u.readyState?u.status>=200&&u.status<300?_.forEach(a.onSuccess,function(t){return t({body:JSON.parse(u.responseText),status:u.status,headers:n(u.getAllResponseHeaders())})}):_.forEach(a.onFailure,function(t){return t({body:JSON.parse(u.responseText),status:u.status,headers:n(u.getAllResponseHeaders())})}):void 0},("POST"===e||"PUT"===e)&&u.setRequestHeader("Content-Type","application/json;charset=utf-8");for(i in o.headers)u.setRequestHeader(i,o.headers[i]);return u.send(r),a},s.prototype.get=function(t,e,n){var s,r;if(n||(n={}),this.authToken&&!n.headers&&(n.headers={},n.headers.Authorization="Bearer "+this.authToken),void 0!==e&&e.length&&0!==e.length){r=[];for(s in e)r.push(encodeURIComponent(s)+"="+encodeURIComponent(e[s]));t+="?"+r.join("&")}return this.sockjs?this._sockReq("get",t,null,n):this.ajax("GET",this.url+t,null,n)},s.prototype.post=function(t,e,n){return n||(n={}),this.authToken&&!n.headers&&(n.headers={},n.headers.Authorization="Bearer "+this.authToken),this.sockjs?this._sockReq("post",t,e,n):this.ajax("POST",this.url+t,JSON.stringify(e),n)},s.prototype.put=function(t,e,n){return n||(n={}),n.dataType="json",n.responseType="json",this.authToken&&!n.headers&&(n.headers={},n.headers.Authorization="Bearer "+this.authToken),this.sockjs?this._sockReq("put",t,e,n):this.ajax("PUT",this.url+t,JSON.stringify(e),n)},s.prototype["delete"]=function(t,e,n){var s,r;if(n||(n={}),this.authToken&&!n.headers&&(n.headers={},n.headers.Authorization="Bearer "+this.authToken),void 0!==e&&e.length&&0!==e.length){r=[];for(s in e)r.push(encodeURIComponent(s)+"="+encodeURIComponent(e[s]));t+="?"+r.join("&")}return this.sockjs?this._sockReq("get",t,null,n):this.ajax("DELETE",this.url+t,null,n)},s.prototype.info=function(){return this.get("/")},s.prototype.accounts={create:{register:function(t){return this.that.post("/accounts",{username:t.username,alt_email:t.alt_email})},verify:function(t){return this.that.post("/accounts",{username:t.username,invite_code:t.invite_code})},setup:function(t){return this.that.post("/accounts",{username:t.username,invite_code:t.invite_code,password:t.password})}},get:function(t){return this.that.get("/accounts/"+t)},update:function(t,e){return this.that.put("/accounts/"+t,e)},"delete":function(t){return this.that["delete"]("/accounts/"+t)},wipeData:function(t){return this.that.post("/accounts/"+t("/wipe-data"))}},s.prototype.attachments={list:function(){return this.that.get("/attachments")},create:function(t){return this.that.post("/attachments",{data:t.data,name:t.name,encoding:t.encoding,version_major:t.version_major,version_minor:t.version_minor,pgp_fingerprints:t.pgp_fingerprints})},get:function(t){return this.that.get("/attachments/"+t)},update:function(t,e){return this.that.put("/attachments/"+t,{data:e.data,name:e.name,encoding:e.encoding,version_major:e.version_major,version_minor:e.version_minor,pgp_fingerprints:e.pgp_fingerprints})},"delete":function(t){return this.that["delete"]("/attachments/"+t)}},s.prototype.contacts={list:function(){return this.that.get("/contacts")},create:function(t){return this.that.post("/contacts",{data:t.data,name:t.name,encoding:t.encoding,version_major:t.version_major,version_minor:t.version_minor,pgp_fingerprints:t.pgp_fingerprints})},get:function(t){return this.that.get("/contacts/"+t)},update:function(t,e){return this.that.put("/contacts/"+t,{data:e.data,name:e.name,encoding:e.encoding,version_major:e.version_major,version_minor:e.version_minor,pgp_fingerprints:e.pgp_fingerprints})},"delete":function(t){return this.that["delete"]("/contacts/"+t)}},s.prototype.emails={list:function(t){var n;return n="/emails",t&&_.size(t)>0&&(n+="?"+e(t)),this.that.get(n)},get:function(t){return this.that.get("/emails/"+t)},create:function(t){return this.that.post("/emails",{to:t.to,bcc:t.bcc,reply_to:t.reply_to,thread_id:t.thread_id,subject:t.subject,is_encrypted:t.is_encrypted,body:t.body,body_version_major:t.body_version_major,body_version_minor:t.body_version_minor,preview:t.preview,preview_version_major:t.preview_version_major,preview_version_minor:t.preview_version_minor,attachments:t.attachments,pgp_fingerprints:t.pgp_fingerprints})},"delete":function(t){return this.that["delete"]("/emails/"+t)}},s.prototype.keys={list:function(t){return this.that.get("/keys?user="+t)},get:function(t){return this.that.get("/keys/"+encodeURIComponent(t))},create:function(t){return this.that.post("/keys",{key:t})}},s.prototype.labels={list:function(){return this.that.get("/labels")},get:function(t){return this.that.get("/labels/"+t)},create:function(t){return this.that.post("/labels",{name:t.name})},"delete":function(t){return this.that["delete"]("/labels/"+t)},update:function(t,e){return this.that.put("/labels/"+t,{name:e.name})}},s.prototype.tokens={getCurrent:function(){return this.that.get("/tokens")},get:function(t){return this.that.get("/tokens/"+t)},create:function(t){return this.that.post("/tokens",{username:t.username,password:t.password,type:t.type,token:t.token})},deleteCurrent:function(){return this.that["delete"]("/tokens")},"delete":function(t){return this.that["delete"]("/tokens/"+t)}},s}()}).call(this);
//# sourceMappingURL=lavaboom-api.js.map